# План Действий (Linux + Astra Linux)

## Этап 1. Базовая фиксация

### Команда
```bash
date -u
```
Что делает: фиксирует текущее UTC-время для таймлайна.
Параметры: `-u` - вывести время в UTC.

### Команда
```bash
timedatectl
```
Что делает: показывает таймзону и синхронизацию времени.
Параметры: без параметров - общий статус времени.

### Команда
```bash
script -a session.log
```
Что делает: пишет всю сессию терминала в лог.
Параметры: `-a` - дописывать в файл, а не перезаписывать.

## Этап 2. Кто входил и что делал

### Команда
```bash
who
```
Что делает: показывает текущие интерактивные сессии.
Параметры: без параметров - активные логины.

### Команда
```bash
w
```
Что делает: показывает пользователей и их текущие процессы.
Параметры: без параметров - краткий обзор активности.

### Команда
```bash
last -a | head -n 50
```
Что делает: показывает последние успешные входы.
Параметры: `-a` - IP/хост в конце строки; `head -n 50` - первые 50 строк.

### Команда
```bash
lastb -a | head -n 50
```
Что делает: показывает последние неуспешные входы.
Параметры: `-a` - IP/хост; `head -n 50` - ограничение вывода.

## Этап 3. Процессы и сеть

### Команда
```bash
ps aux --sort=-%cpu | head -n 40
```
Что делает: выводит самые CPU-нагруженные процессы.
Параметры: `a` - все пользователи, `u` - владелец/CPU/MEM, `x` - без TTY, `--sort=-%cpu` - сортировка по CPU.

### Команда
```bash
pstree -ap | head -n 120
```
Что делает: дерево процессов для поиска parent-child аномалий.
Параметры: `-a` - аргументы командной строки, `-p` - PID.

### Команда
```bash
ss -tulpen
```
Что делает: показывает сетевые сокеты и привязанные процессы.
Параметры: `-t` TCP, `-u` UDP, `-l` listening, `-p` process, `-e` extra, `-n` numeric.

## Этап 4. Persistence

### Команда
```bash
crontab -l
```
Что делает: показывает cron-задачи текущего пользователя.
Параметры: `-l` - листинг задач.

### Команда
```bash
systemctl list-timers --all
```
Что делает: показывает все systemd timers (включая неактивные).
Параметры: `--all` - полный список.

### Команда
```bash
systemctl list-unit-files --type=service | grep enabled
```
Что делает: показывает включенные сервисы systemd.
Параметры: `--type=service` - только сервисы.

## Этап 5. Файлы и повышение привилегий

### Команда
```bash
find /tmp /var/tmp /dev/shm -type f -mmin -360 2>/dev/null
```
Что делает: ищет файлы, измененные за последние 6 часов в временных папках.
Параметры: `-type f` - файлы, `-mmin -360` - младше 360 минут.

### Команда
```bash
find / -xdev -perm -4000 -type f 2>/dev/null
```
Что делает: ищет SUID-файлы.
Параметры: `-xdev` - не выходить за текущую ФС, `-perm -4000` - SUID бит установлен.

### Команда
```bash
getcap -r / 2>/dev/null
```
Что делает: ищет Linux capabilities у файлов.
Параметры: `-r` - рекурсивно.

## Этап 6. Astra Linux дополнительно

### Команда
```bash
astra-mic-control status
```
Что делает: показывает статус мандатного контроля целостности (MIC).
Параметры: `status` - вывод текущего состояния.

### Команда
```bash
pdpl-user <user>
```
Что делает: показывает метки/уровни для пользователя.
Параметры: `<user>` - интересующий аккаунт.

### Команда
```bash
pdpl-file /etc/ssh
```
Что делает: показывает метки/уровни для объекта ФС.
Параметры: путь к файлу/каталогу.
